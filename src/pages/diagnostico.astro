---
// Simple test script to check data
const supabaseUrl = 'https://wlkjxdhjcbyimozkvuxb.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indsa2p4ZGhqY2J5aW1vemt2dXhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyOTA1NDEsImV4cCI6MjA3Mjg2NjU0MX0.VMofJMFZzuzXHGM6OEGChdSTlwuZdZGD6rRGPMqlbuw';

let testResults = {
  profile: null,
  projects: null,
  social_links: null,
  site_settings: null,
  errors: {}
};

// Function to test each table
async function testTable(tableName) {
  try {
    const response = await fetch(`${supabaseUrl}/rest/v1/${tableName}?select=*`, {
      headers: {
        'apikey': supabaseKey,
        'Authorization': `Bearer ${supabaseKey}`,
        'Content-Type': 'application/json'
      }
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
    }

    const data = await response.json();
    return { success: true, data, count: Array.isArray(data) ? data.length : (data ? 1 : 0) };
  } catch (error) {
    return { success: false, error: error.message };
  }
}

// Test all tables
const profileResult = await testTable('profile');
const projectsResult = await testTable('projects');
const socialResult = await testTable('social_links');
const settingsResult = await testTable('site_settings');

testResults = {
  profile: profileResult,
  projects: projectsResult,
  social_links: socialResult,
  site_settings: settingsResult
};
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagn√≥stico Completo CMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
  <div class="max-w-6xl mx-auto px-4">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">üîç Diagn√≥stico Completo CMS</h1>
      <p class="text-xl text-gray-600">Verificando conexi√≥n y datos en Supabase</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Profile -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-blue-600 text-white px-6 py-4">
          <h2 class="text-2xl font-semibold flex items-center">
            <span class="mr-2">üë§</span> Perfil
          </h2>
        </div>
        <div class="p-6">
          {testResults.profile.success ? (
            <div class="space-y-4">
              <div class="flex items-center text-green-600 font-semibold">
                <span class="mr-2">‚úÖ</span>
                <span>Conexi√≥n exitosa</span>
              </div>
              <div class="text-sm text-gray-600">
                <strong>Registros encontrados:</strong> {testResults.profile.count}
              </div>
              {testResults.profile.data && testResults.profile.data.length > 0 && (
                <div>
                  <h3 class="font-semibold mb-2">Datos del perfil:</h3>
                  <pre class="bg-gray-100 p-4 rounded text-xs overflow-x-auto max-h-64">
{JSON.stringify(testResults.profile.data[0], null, 2)}
                  </pre>
                </div>
              )}
            </div>
          ) : (
            <div class="text-red-600">
              <div class="flex items-center font-semibold mb-2">
                <span class="mr-2">‚ùå</span>
                <span>Error de conexi√≥n</span>
              </div>
              <p class="text-sm bg-red-50 p-3 rounded">{testResults.profile.error}</p>
            </div>
          )}
        </div>
      </div>

      <!-- Projects -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-green-600 text-white px-6 py-4">
          <h2 class="text-2xl font-semibold flex items-center">
            <span class="mr-2">üìÇ</span> Proyectos
          </h2>
        </div>
        <div class="p-6">
          {testResults.projects.success ? (
            <div class="space-y-4">
              <div class="flex items-center text-green-600 font-semibold">
                <span class="mr-2">‚úÖ</span>
                <span>Conexi√≥n exitosa</span>
              </div>
              <div class="text-sm text-gray-600">
                <strong>Proyectos encontrados:</strong> {testResults.projects.count}
              </div>
              {testResults.projects.data && testResults.projects.data.length > 0 && (
                <div>
                  <h3 class="font-semibold mb-2">Estructura del primer proyecto:</h3>
                  <div class="space-y-2">
                    {Object.keys(testResults.projects.data[0]).map(key => (
                      <div class="text-sm">
                        <span class="font-medium text-blue-600">{key}:</span>
                        <span class="ml-2 text-gray-700">
                          {typeof testResults.projects.data[0][key] === 'object' 
                            ? JSON.stringify(testResults.projects.data[0][key])
                            : String(testResults.projects.data[0][key]).substring(0, 50) + (String(testResults.projects.data[0][key]).length > 50 ? '...' : '')
                          }
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          ) : (
            <div class="text-red-600">
              <div class="flex items-center font-semibold mb-2">
                <span class="mr-2">‚ùå</span>
                <span>Error de conexi√≥n</span>
              </div>
              <p class="text-sm bg-red-50 p-3 rounded">{testResults.projects.error}</p>
            </div>
          )}
        </div>
      </div>

      <!-- Social Links -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-purple-600 text-white px-6 py-4">
          <h2 class="text-2xl font-semibold flex items-center">
            <span class="mr-2">üîó</span> Enlaces Sociales
          </h2>
        </div>
        <div class="p-6">
          {testResults.social_links.success ? (
            <div class="space-y-4">
              <div class="flex items-center text-green-600 font-semibold">
                <span class="mr-2">‚úÖ</span>
                <span>Conexi√≥n exitosa</span>
              </div>
              <div class="text-sm text-gray-600">
                <strong>Enlaces encontrados:</strong> {testResults.social_links.count}
              </div>
              {testResults.social_links.data && testResults.social_links.data.length > 0 && (
                <div>
                  <h3 class="font-semibold mb-2">Enlaces disponibles:</h3>
                  <div class="space-y-2">
                    {testResults.social_links.data.map((link, index) => (
                      <div class="flex items-center text-sm bg-gray-50 p-2 rounded">
                        <span class="font-medium text-purple-600">{link.platform || 'N/A'}:</span>
                        <span class="ml-2 text-gray-700">{link.url || 'N/A'}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          ) : (
            <div class="text-red-600">
              <div class="flex items-center font-semibold mb-2">
                <span class="mr-2">‚ùå</span>
                <span>Error de conexi√≥n</span>
              </div>
              <p class="text-sm bg-red-50 p-3 rounded">{testResults.social_links.error}</p>
            </div>
          )}
        </div>
      </div>

      <!-- Site Settings -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-orange-600 text-white px-6 py-4">
          <h2 class="text-2xl font-semibold flex items-center">
            <span class="mr-2">‚öôÔ∏è</span> Configuraciones
          </h2>
        </div>
        <div class="p-6">
          {testResults.site_settings.success ? (
            <div class="space-y-4">
              <div class="flex items-center text-green-600 font-semibold">
                <span class="mr-2">‚úÖ</span>
                <span>Conexi√≥n exitosa</span>
              </div>
              <div class="text-sm text-gray-600">
                <strong>Configuraciones encontradas:</strong> {testResults.site_settings.count}
              </div>
              {testResults.site_settings.data && testResults.site_settings.data.length > 0 && (
                <div>
                  <h3 class="font-semibold mb-2">Configuraciones disponibles:</h3>
                  <div class="max-h-48 overflow-y-auto">
                    <pre class="text-xs bg-gray-100 p-3 rounded">
{JSON.stringify(testResults.site_settings.data, null, 2)}
                    </pre>
                  </div>
                </div>
              )}
            </div>
          ) : (
            <div class="text-red-600">
              <div class="flex items-center font-semibold mb-2">
                <span class="mr-2">‚ùå</span>
                <span>Error de conexi√≥n</span>
              </div>
              <p class="text-sm bg-red-50 p-3 rounded">{testResults.site_settings.error}</p>
            </div>
          )}
        </div>
      </div>
    </div>

    <div class="mt-8 text-center space-x-4">
      <a href="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
        ‚Üê Volver al Portfolio
      </a>
      <button onclick="location.reload()" class="inline-flex items-center px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">
        üîÑ Actualizar Datos
      </button>
    </div>
  </div>
</body>
</html>
