---
import { supabase } from '../lib/supabase.js';

// Probar conexi√≥n y obtener estructura real
let connectionStatus = 'Conectando...';
let profileData = null;
let projectsData = null;
let socialLinksData = null;
let siteSettingsData = null;
let errors = {};

try {
  // Test perfil
  try {
    const { data: profile, error: profileError } = await supabase
      .from('profile')
      .select('*')
      .limit(1)
      .single();
    
    if (profileError) {
      errors.profile = profileError.message;
    } else {
      profileData = profile;
    }
  } catch (e) {
    errors.profile = e.message;
  }

  // Test proyectos - intentar con diferentes nombres de columnas
  try {
    const { data: projects, error: projectsError } = await supabase
      .from('projects')
      .select('*')
      .limit(3);
    
    if (projectsError) {
      errors.projects = projectsError.message;
    } else {
      projectsData = projects;
    }
  } catch (e) {
    errors.projects = e.message;
  }

  // Test social links
  try {
    const { data: social, error: socialError } = await supabase
      .from('social_links')
      .select('*');
    
    if (socialError) {
      errors.social_links = socialError.message;
    } else {
      socialLinksData = social;
    }
  } catch (e) {
    errors.social_links = e.message;
  }

  // Test site settings
  try {
    const { data: settings, error: settingsError } = await supabase
      .from('site_settings')
      .select('*');
    
    if (settingsError) {
      errors.site_settings = settingsError.message;
    } else {
      siteSettingsData = settings;
    }
  } catch (e) {
    errors.site_settings = e.message;
  }

  connectionStatus = 'Conectado ‚úÖ';

} catch (error) {
  connectionStatus = `Error de conexi√≥n: ${error.message}`;
}
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Conexi√≥n Supabase</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen py-8">
  <div class="max-w-4xl mx-auto px-4">
    <div class="bg-white rounded-lg shadow-lg p-8">
      <h1 class="text-3xl font-bold text-center mb-8">üîç Test Conexi√≥n Supabase</h1>
      
      <!-- Estado de conexi√≥n -->
      <div class="mb-8 p-4 bg-blue-50 rounded-lg">
        <h2 class="text-lg font-semibold mb-2">Estado de Conexi√≥n:</h2>
        <p class="text-xl">{connectionStatus}</p>
      </div>

      <!-- Profile -->
      <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-blue-600">üë§ Perfil</h2>
        {errors.profile ? (
          <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
            <p class="text-red-700">‚ùå Error: {errors.profile}</p>
          </div>
        ) : profileData ? (
          <div class="bg-green-50 border-l-4 border-green-500 p-4">
            <p class="text-green-700 mb-2">‚úÖ Datos encontrados:</p>
            <pre class="text-sm bg-white p-3 rounded overflow-x-auto">{JSON.stringify(profileData, null, 2)}</pre>
          </div>
        ) : (
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="text-yellow-700">‚ö†Ô∏è Sin datos de perfil</p>
          </div>
        )}
      </div>

      <!-- Projects -->
      <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-green-600">üìÇ Proyectos</h2>
        {errors.projects ? (
          <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
            <p class="text-red-700">‚ùå Error: {errors.projects}</p>
          </div>
        ) : projectsData && projectsData.length > 0 ? (
          <div class="bg-green-50 border-l-4 border-green-500 p-4">
            <p class="text-green-700 mb-2">‚úÖ {projectsData.length} proyecto(s) encontrado(s):</p>
            <div class="space-y-4">
              {projectsData.map((project, index) => (
                <div class="bg-white p-3 rounded">
                  <h3 class="font-semibold">Proyecto {index + 1}:</h3>
                  <pre class="text-sm overflow-x-auto mt-2">{JSON.stringify(project, null, 2)}</pre>
                </div>
              ))}
            </div>
          </div>
        ) : (
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="text-yellow-700">‚ö†Ô∏è Sin proyectos</p>
          </div>
        )}
      </div>

      <!-- Social Links -->
      <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-purple-600">üîó Enlaces Sociales</h2>
        {errors.social_links ? (
          <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
            <p class="text-red-700">‚ùå Error: {errors.social_links}</p>
          </div>
        ) : socialLinksData && socialLinksData.length > 0 ? (
          <div class="bg-green-50 border-l-4 border-green-500 p-4">
            <p class="text-green-700 mb-2">‚úÖ {socialLinksData.length} enlace(s) encontrado(s):</p>
            <pre class="text-sm bg-white p-3 rounded overflow-x-auto">{JSON.stringify(socialLinksData, null, 2)}</pre>
          </div>
        ) : (
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="text-yellow-700">‚ö†Ô∏è Sin enlaces sociales</p>
          </div>
        )}
      </div>

      <!-- Site Settings -->
      <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-4 text-orange-600">‚öôÔ∏è Configuraciones</h2>
        {errors.site_settings ? (
          <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
            <p class="text-red-700">‚ùå Error: {errors.site_settings}</p>
          </div>
        ) : siteSettingsData && siteSettingsData.length > 0 ? (
          <div class="bg-green-50 border-l-4 border-green-500 p-4">
            <p class="text-green-700 mb-2">‚úÖ {siteSettingsData.length} configuraci√≥n(es) encontrada(s):</p>
            <pre class="text-sm bg-white p-3 rounded overflow-x-auto">{JSON.stringify(siteSettingsData, null, 2)}</pre>
          </div>
        ) : (
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="text-yellow-700">‚ö†Ô∏è Sin configuraciones</p>
          </div>
        )}
      </div>

      <div class="text-center space-x-4">
        <a href="/" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
          ‚Üê Portfolio Principal
        </a>
        <a href="/debug-cms" class="inline-flex items-center px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">
          Debug CMS Completo
        </a>
      </div>
    </div>
  </div>
</body>
</html>
